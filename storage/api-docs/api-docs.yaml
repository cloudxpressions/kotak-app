openapi: 3.0.0
info:
  title: K+ API Documentation
  description: Comprehensive REST API for K+ application serving React frontend
  version: 1.0.0
  contact:
    name: API Support
    email: support@kplus.com

servers:
  - url: http://localhost/api
    description: Local development server
  - url: https://api.kplus.com/api
    description: Production server

tags:
  - name: Authentication
    description: User authentication endpoints
  - name: User Profile
    description: User profile management
  - name: Master Data
    description: Reference data for forms
  - name: AdMob
    description: AdMob settings for mobile app
  - name: Testimonials
    description: Customer testimonials
  - name: FAQs
    description: Frequently asked questions and answers
  - name: Languages
    description: Available UI languages
  - name: Legal Pages
    description: Legal pages (Privacy, Terms, etc.)
  - name: Blog
    description: Blog posts, categories, tags, comments, ratings
  - name: Newsletter
    description: Newsletter subscription management
  - name: Settings
    description: Application settings
  - name: reCAPTCHA
    description: reCAPTCHA configuration and verification

components:
  securitySchemes:
    sanctum:
      type: http
      scheme: bearer
      bearerFormat: token
      description: Laravel Sanctum authentication token

  schemas:
    Error:
      type: object
      properties:
        message:
          type: string
          example: "Error message"
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string

    AdMobSettings:
      type: object
      properties:
        id:
          type: integer
        app_id:
          type: string
          nullable: true
        banner_id:
          type: string
          nullable: true
        interstitial_id:
          type: string
          nullable: true
        rewarded_id:
          type: string
          nullable: true
        native_id:
          type: string
          nullable: true
        is_live:
          type: boolean

    Testimonial:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        designation:
          type: string
          nullable: true
        message:
          type: string
        avatar:
          type: string
          nullable: true
        rating:
          type: integer
          minimum: 1
          maximum: 5
        sort_order:
          type: integer
        is_visible:
          type: boolean
        created_at:
          type: string
          format: date-time
    Faq:
      type: object
      properties:
        id:
          type: integer
        category:
          type: string
          nullable: true
        question:
          type: string
        answer:
          type: string
        sort_order:
          type: integer
        is_featured:
          type: boolean
    LegalPage:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        slug:
          type: string
        content:
          type: string
        is_active:
          type: boolean
        seo:
          type: object
          properties:
            title:
              type: string
              nullable: true
            description:
              type: string
              nullable: true
            keywords:
              type: string
              nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    BlogCategory:
      type: object
      properties:
        id:
          type: integer
        parent_id:
          type: integer
          nullable: true
        is_active:
          type: boolean
        translations:
          type: array
          items:
            type: object
            properties:
              language_id:
                type: integer
              name:
                type: string
              slug:
                type: string

    BlogTag:
      type: object
      properties:
        id:
          type: integer
        translations:
          type: array
          items:
            type: object
            properties:
              language_id:
                type: integer
              name:
                type: string
              slug:
                type: string

    BlogPost:
      type: object
      properties:
        id:
          type: integer
        slug:
          type: string
        image:
          type: string
          nullable: true
        image_url:
          type: string
          nullable: true
        is_featured:
          type: boolean
        is_breaking:
          type: boolean
        is_recommended:
          type: boolean
        publish_status:
          type: string
          enum: [draft, scheduled, published]
        publish_date:
          type: string
          format: date-time
          nullable: true
        average_rating:
          type: number
          format: float
        rating_count:
          type: integer
        translations:
          type: array
          items:
            type: object
            properties:
              language_id:
                type: integer
              title:
                type: string
              summary:
                type: string
              content:
                type: string
        category:
          $ref: '#/components/schemas/BlogCategory'
        tags:
          type: array
          items:
            $ref: '#/components/schemas/BlogTag'

    RecaptchaConfig:
      type: object
      properties:
        site_key:
          type: string
        is_enabled:
          type: boolean
        version:
          type: string
          enum: [v2_checkbox, v2_invisible, v3]
        v3_score_threshold:
          type: number
          format: float
          nullable: true
        captcha_for_login:
          type: boolean
        captcha_for_register:
          type: boolean
        captcha_for_contact:
          type: boolean

paths:
  /admob/settings:
    get:
      tags:
        - AdMob
      summary: Get AdMob settings
      description: Retrieve AdMob configuration for mobile app
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/AdMobSettings'
        '404':
          description: Settings not configured

  /testimonials:
    get:
      tags:
        - Testimonials
      summary: Get all testimonials
      description: Retrieve all visible testimonials sorted by order
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Testimonial'

  /legal-pages:
    get:
      tags:
        - Legal Pages
      summary: Get all legal pages
      description: Retrieve all active legal pages
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/LegalPage'

  /legal-pages/{slug}:
    get:
      tags:
        - Legal Pages
      summary: Get legal page by slug
      description: Retrieve a specific legal page by its slug
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/LegalPage'
        '404':
          description: Legal page not found

  /blog/categories:
    get:
      tags:
        - Blog
      summary: Get blog categories
      description: Retrieve all active blog categories with translations
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/BlogCategory'

  /blog/tags:
    get:
      tags:
        - Blog
      summary: Get blog tags
      description: Retrieve all active blog tags with translations
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/BlogTag'

  /blog/posts:
    get:
      tags:
        - Blog
      summary: Get blog posts
      description: Retrieve published blog posts with filters and pagination
      parameters:
        - name: category_id
          in: query
          schema:
            type: integer
          description: Filter by category ID
        - name: tag_id
          in: query
          schema:
            type: integer
          description: Filter by tag ID
        - name: featured
          in: query
          schema:
            type: boolean
          description: Filter featured posts
        - name: breaking
          in: query
          schema:
            type: boolean
          description: Filter breaking news
        - name: recommended
          in: query
          schema:
            type: boolean
          description: Filter recommended posts
        - name: search
          in: query
          schema:
            type: string
          description: Search in title, summary, content
        - name: sort_by
          in: query
          schema:
            type: string
            default: publish_date
          description: Sort field
        - name: sort_order
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order
        - name: per_page
          in: query
          schema:
            type: integer
            default: 15
          description: Items per page
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/BlogPost'
                  meta:
                    type: object
                    properties:
                      current_page:
                        type: integer
                      last_page:
                        type: integer
                      per_page:
                        type: integer
                      total:
                        type: integer

  /blog/posts/{slug}:
    get:
      tags:
        - Blog
      summary: Get blog post by slug
      description: Retrieve a single blog post with full details
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/BlogPost'
        '404':
          description: Blog post not found

  /blog/posts/{id}/comments:
    get:
      tags:
        - Blog
      summary: Get post comments
      description: Retrieve approved comments for a blog post
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Successful response
        '404':
          description: Blog post not found

    post:
      tags:
        - Blog
      summary: Add comment
      description: Add a comment to a blog post (requires authentication)
      security:
        - sanctum: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - comment
              properties:
                comment:
                  type: string
                  minLength: 3
                  maxLength: 1000
      responses:
        '201':
          description: Comment submitted successfully
        '401':
          description: Unauthorized
        '404':
          description: Blog post not found

  /blog/posts/{id}/rate:
    post:
      tags:
        - Blog
      summary: Rate blog post
      description: Rate a blog post (requires authentication)
      security:
        - sanctum: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - rating
              properties:
                rating:
                  type: integer
                  minimum: 1
                  maximum: 5
      responses:
        '200':
          description: Rating submitted successfully
        '401':
          description: Unauthorized
        '404':
          description: Blog post not found

  /newsletter/subscribe:
    post:
      tags:
        - Newsletter
      summary: Subscribe to newsletter
      description: Subscribe to newsletter with email verification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                name:
                  type: string
                  nullable: true
                source:
                  type: string
                  nullable: true
      responses:
        '201':
          description: Subscription successful
        '422':
          description: Validation error

  /newsletter/verify/{token}:
    get:
      tags:
        - Newsletter
      summary: Verify email subscription
      description: Verify email subscription using token
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Email verified successfully
        '404':
          description: Invalid or expired token

  /newsletter/unsubscribe:
    post:
      tags:
        - Newsletter
      summary: Unsubscribe from newsletter
      description: Unsubscribe from newsletter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Unsubscribed successfully
        '404':
          description: Email not found

  /settings:
    get:
      tags:
        - Settings
      summary: Get all settings
      description: Retrieve all application settings
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: object
                    additionalProperties: true

  /settings/{key}:
    get:
      tags:
        - Settings
      summary: Get setting by key
      description: Retrieve a specific setting by key
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
        '404':
          description: Setting not found

  /recaptcha/config:
    get:
      tags:
        - reCAPTCHA
      summary: Get reCAPTCHA config
      description: Retrieve reCAPTCHA public configuration
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/RecaptchaConfig'

  /recaptcha/verify:
    post:
      tags:
        - reCAPTCHA
      summary: Verify reCAPTCHA token
      description: Server-side verification of reCAPTCHA token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
              properties:
                token:
                  type: string
                action:
                  type: string
                  nullable: true
      responses:
        '200':
          description: Verification result
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  verified:
                    type: boolean
                  score:
                    type: number
                    format: float
                    nullable: true

  /faqs:
    get:
      tags:
        - FAQs
      summary: Get frequently asked questions
      description: Retrieve FAQs for marketing/support screens. Supports filtering by featured flag or category.
      parameters:
        - in: query
          name: featured
          schema:
            type: boolean
          description: When true, returns only featured FAQs.
        - in: query
          name: category
          schema:
            type: string
          description: Filter FAQs by exact category name.
        - in: query
          name: locale
          schema:
            type: string
          description: Override the locale used for translations (`en`, `ta`). Defaults to the app locale.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Faq'

  /languages:
    get:
      tags:
        - Languages
      summary: Get available languages
      description: Returns active languages with id, name, and ISO code for use in dropdowns.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        name:
                          type: string
                        code:
                          type: string
